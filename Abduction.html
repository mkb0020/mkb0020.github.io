<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ∏</title>
  <link rel="stylesheet" href="assets/css/KittyStyle.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
    
    body {
      font-family: 'Orbitron', monospace;
      overflow-x: hidden;
      overflow-y: auto;
    }
    
    .main-container {
      min-height: 100vh;
      padding: 10px 2rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      z-index: 10;
    }
    
    .game-container {
      width: 100%;
      max-width: 1200px;
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .title {
      font-size: 3rem;
      font-weight: 900;
      color: #67FEBD;
      text-shadow: 
        0 0 20px rgba(103, 254, 189, 0.8),
        0 0 40px rgba(103, 254, 189, 0.5),
        0 0 60px rgba(103, 254, 189, 0.3);
      margin-bottom: 1rem;
      animation: glow 2s ease-in-out infinite;
      font-family: 'Orbitron', sans-serif;
    }
    
    @keyframes glow {
      0%, 100% { text-shadow: 0 0 20px rgba(103, 254, 189, 0.8), 0 0 40px rgba(103, 254, 189, 0.5); }
      50% { text-shadow: 0 0 30px rgba(103, 254, 189, 1), 0 0 60px rgba(103, 254, 189, 0.8); }
    }
    
    .stats {
      display: none; 
    }
    
    canvas {
      border: 4px solid #67FEBD;
      border-radius: 15px;
      box-shadow: 
        0 0 30px rgba(103, 254, 189, 0.5),
        0 0 60px rgba(220, 76, 232, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.5);
      background: #000;
      cursor: none;
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }
    
    .controls {
      margin-top: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
      line-height: 1.6;
      padding: 0 1rem;
    }
    
    .controls strong {
      color: #67FEBD;
    }
    
    .message {
      display: none; 
    }
    
    /* MOBILE */
    .mobile-controls {
      display: none;
      margin-top: 2rem;
      gap: 2rem;
      align-items: center;
      justify-content: center;
    }
    
    .dpad {
      position: relative;
      width: 150px;
      height: 150px;
      display: grid;
      grid-template-areas:
        ". up ."
        "left . right"
        ". down .";
      gap: 5px;
    }
    
    .dpad-btn {
      width: 50px;
      height: 50px;
      background: rgba(103, 254, 189, 0.3);
      border: 2px solid #67FEBD;
      border-radius: 8px;
      color: #67FEBD;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }
    
    .dpad-up { grid-area: up; }
    .dpad-left { grid-area: left; }
    .dpad-down { grid-area: down; }
    .dpad-right { grid-area: right; }
    
    .dpad-btn:active {
      background: rgba(103, 254, 189, 0.6);
      transform: scale(0.95);
      box-shadow: 0 0 20px rgba(103, 254, 189, 0.8);
    }
    
    .action-btn {
      width: 120px;
      height: 120px;
      background: rgba(220, 76, 232, 0.3);
      border: 3px solid #dc4ce8;
      border-radius: 50%;
      color: #dc4ce8;
      font-size: 16px;
      font-weight: bold;
      font-family: 'Orbitron', sans-serif;
      cursor: pointer;
      transition: all 0.1s;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }
    
    .action-btn:active {
      background: rgba(220, 76, 232, 0.6);
      transform: scale(0.95);
      box-shadow: 0 0 30px rgba(220, 76, 232, 0.8);
    }
    
    .mute-btn {
      position: absolute;
      top: 110px;
      right: 20px;
      z-index: 20;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #67FEBD;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 22px;
      color: #67FEBD;
      cursor: pointer;
    }

    .mute-btn:active {
      transform: scale(0.9);
    }



    @media (max-width: 900px) {
      .title { font-size: 2rem; }
      .stats { 
        flex-direction: column; 
        gap: 0.5rem;
        align-items: center;
      }
      .main-container {
        padding: 80px 1rem 1rem;
      }
      canvas {
        width: 100%;
        height: auto;
      }
      
      .mobile-controls {
        display: flex;
      }
    }
    
    @media (min-width: 901px) and (max-width: 1200px) {
      .mobile-controls {
        display: flex;
      }
    }
  </style>
</head>
<body>
  <div id="stars"></div>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="left-dropdown">
        <button class="menu-trigger" aria-label="Menu">
          <img src="/assets/images/Niels2.png" alt="Menu" class="home-icon">
        </button>
        <div class="left-menu">
          <a href="https://mkb0020.onrender.com" class="menu-item">Home</a>
          <a href="https://mkb0020.github.io/" class="menu-item">Javascript Projects</a>
          <a href="https://mkb0020.github.io/Toolkit.html" class="menu-item">Schr√∂dinger's Toolbox</a>
          <a href="https://mkb0020.onrender.com/resume" class="menu-item">Resume</a>
          <a href="https://ko-fi.com/mkb0020" class="menu-item">Feed the cats</a>
          <a href="https://mkb0020.onrender.com/contact" class="menu-item">Contact</a>
          <a href="https://mkb0020.onrender.com/review" class="menu-item">Review CATastrophe 2</a>
          <a href="https://mkb0020.onrender.com/admin_login" class="menu-item">Admin</a>
        </div>
      </div>

      <a href="https://mkb0020.github.io">
        <div class="logo">‚ô° mkb0020</div>
      </a>

      <div class="help-dropdown">
        <button class="help-icon" id="helpBtn" aria-label="Help Menu">
          <div class="question-mark">?</div>
        </button>
        <div class="dropdown-menu" id="dropdownMenu">
          <button id="openMainHelp">About</button>
          <a href="https://mkb0020.onrender.com/support" class="menu-item">Report an Issue</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- HELP MODAL -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title">COW ABDUCTION... GAME?</h1>
        <button class="modal-close" id="closeModal">X</button>
      </div>
      <div class="modal-body">
        <h3>Welcome to the Pasture!</h3>
        <p>You're a friendly alien UFO pilot on a mission to... well, there is no mission! Just fly around and beam up cows for fun. ‚ú®</p>
        
        <h3>How to Play</h3>
        <ul>
          <li><strong>WASD or Arrow Keys:</strong> Fly the UFO around</li>
          <li><strong>SPACE:</strong> Activate tractor beam to abduct cows</li>
          <li><strong>Goal:</strong> There is none! </li>
        </ul>

        <h3>Fun Features</h3>
        <ul>
          <li>Cows wander around and get scared when you're near</li>
          <li>Sparkle effects when abducting</li>
          <li>New cows spawn to keep the fun going</li>
          <li>Random cow facts and puns</li>
          <li>Satisfaction meter (just for fun!)</li>
        </ul>

        <p style="text-align: center; margin-top: 2rem; color: #67FEBD;">
          <strong>NOTE:</strong> No cows were harmed in the making of this game! üíö
        </p>
      </div>
    </div>
  </div>

  <button class="floating-back-to-top" id="floatingBackToTop">‚Üë</button>

  <!-- MAIN GAME CONTAINER -->
  <div class="main-container">
    <div class="game-container">
      
      <canvas id="canvas" width="1000" height="450"></canvas>


      
      <!-- MOBILE -->
      <div class="mobile-controls" id="mobileControls">
        <div class="dpad">
          <button class="dpad-btn dpad-up" data-key="w">‚Üë</button>
          <button class="dpad-btn dpad-left" data-key="a">‚Üê</button>
          <button class="dpad-btn dpad-down" data-key="s">‚Üì</button>
          <button class="dpad-btn dpad-right" data-key="d">‚Üí</button>
        </div>
        <button class="action-btn" data-key=" ">ABDUCT</button>
      </div>
      <div class="controls">
        <strong>WASD</strong> or <strong>Arrow Keys</strong> to fly ¬∑ <strong>SPACE</strong> to abduct<br>
        <strong>Mobile:</strong> Use on-screen buttons below the canvas<br>
        <strong>Mute/Unmute Music:</strong> Desktop: press "M" | Mobile: tap the butto in the top-right <br>
        Fly over cows and beam them up! No pressure, just vibes ‚ú®
      </div>

    </div>
  </div>

  <div class="message" id="message"></div>

  <div id="kofi-float">
    <a href="https://ko-fi.com/mkb0020" target="_blank" rel="noopener noreferrer">
      <img src="assets/images/tipjar.png" alt="Support me on Ko-fi">
      <div class="hearts">
        <div class="heart" style="--delay: 0s; --drift: -20px;">‚ù§Ô∏è</div>
        <div class="heart" style="--delay: 0.5s; --drift: 15px;">üíñ</div>
        <div class="heart" style="--delay: 1s; --drift: -10px;">üíï</div>
        <div class="heart" style="--delay: 1.5s; --drift: 20px;">‚ù§Ô∏è</div>
        <div class="heart" style="--delay: 2s; --drift: -15px;">üíó</div>
        <div class="heart" style="--delay: 2.5s; --drift: 10px;">üíñ</div>
      </div>
    </a>
  </div>

  <!-- SCROLL TO TOP -->
  <div id="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">
    <a href="javascript:void(0);" class="button-container" aria-label="Scroll to top">
      <img src="assets/images/top.png" alt="Scroll to top">
    </a>
  </div>

  <script src="js/KittyCore.js"></script>

  <script>
    const button = document.getElementById('kofi-float');
    button.addEventListener('mouseenter', () => {
      document.querySelectorAll('.heart').forEach(h => {
        h.style.animation = 'none';
        h.offsetHeight;
        h.style.animation = null;
      });
    });

    const starsDiv = document.getElementById('stars');
    for (let i = 0; i < 200; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.width = star.style.height = Math.random() * 2 + 'px';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 4 + 's';
      starsDiv.appendChild(star);
    }

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    const groundY = 400;
    const groundHeight = 100;
    const levelWidth = 5000; 
    
    let score = 0;
    let totalCows = 0;
    let currentMessage = '';
    let messageAlpha = 0;
    let messageTimer = 0;
    let camera = { x: 0 };
    
    const bgMusic = new Audio('assets/sounds/decoherence.mp3');
      bgMusic.loop = true;
      bgMusic.volume = 0.4; 
      let musicStarted = false;

    function startMusicIfNeeded() {
      if (!musicStarted) {
        bgMusic.play().catch(() => {});
        musicStarted = true;
      }
}



    const satisfactionLevels = ['üòê', 'üôÇ', 'üòä', 'üòÑ', 'ü§©', 'ü•≥', '‚ú®'];
    
    const ufoSprite = new Image();
    ufoSprite.src = 'assets/images/UFO3.png';
    
    const cowSpriteSheet = new Image();
    cowSpriteSheet.src = 'assets/images/cow.png';
    
    let cowFrameWidth = 0;
    let cowFrameHeight = 0;
    let spritesLoaded = false;
    
    cowSpriteSheet.onload = () => {
      cowFrameWidth = cowSpriteSheet.width / 9; 
      cowFrameHeight = cowSpriteSheet.height;
      spritesLoaded = true;
      console.log('‚úÖ Cow sprite loaded!', cowFrameWidth, 'x', cowFrameHeight);
    };
    
    ufoSprite.onload = () => {
      console.log('‚úÖ UFO sprite loaded!');
    };
    
    let ufo = {
      x: 500, y: 250,
      vx: 0, vy: 0,
      w: 140, h: 60,
      angle: 0
    };
    
    let cows = [];
    const COW_WIDTH = 80;
    const COW_HEIGHT = 80;
    
    let particles = [];
    
    const keys = {};
    let spaceJustPressed = false;
    
    const abductionMessages = [
      "Moo-velous! üêÑ",
      "Udderly amazing! ‚ú®",
      "Beam me up! üõ∏",
      "To the moon! üåô",
      "Cow-abunga! üåä",
      "Legendary! ‚≠ê",
      "Moo-gnificent! üí´",
      "Space cow! üöÄ",
      "Cosmic! üåü",
      "Out of this world! üåç"
    ];
    
    const cowFacts = [
      "Cows have best friends! üíï",
      "Cows can see almost 360¬∞! üëÄ",
      "Cows produce 200,000 glasses of milk per year! ü•õ",
      "Cows have unique moo accents! üó£Ô∏è",
      "Cows sleep standing up! üò¥",
      "Cows can smell things 6 miles away! üëÉ"
    ];
    
window.addEventListener('keydown', e => {
  startMusicIfNeeded();

  if (e.code === 'Space') {
    e.preventDefault();
    if (!keys.space) spaceJustPressed = true;
    keys.space = true;
  } else {
    keys[e.key] = true;
  }
});

window.addEventListener('keyup', e => {
  if (e.code === 'Space') {
    keys.space = false;
  } else {
    keys[e.key] = false;
  }
});

    
    // MOBILE CONTROLS
    const mobileButtons = document.querySelectorAll('.dpad-btn, .action-btn');
    
    mobileButtons.forEach(btn => {
      const key = btn.dataset.key;
      
      btn.addEventListener('touchstart', (e) => {
          startMusicIfNeeded();
        e.preventDefault();
        if (key === ' ') {
          if (!keys[' ']) spaceJustPressed = true;
        }
        keys[key] = true;
      });
      
      btn.addEventListener('touchend', (e) => {
        e.preventDefault();
        keys[key] = false;
      });
      
      btn.addEventListener('mousedown', (e) => {
        e.preventDefault();
        if (key === ' ') {
          if (!keys[' ']) spaceJustPressed = true;
        }
        keys[key] = true;
      });
      
      btn.addEventListener('mouseup', (e) => {
        e.preventDefault();
        keys[key] = false;
      });
      
      btn.addEventListener('mouseleave', (e) => {
        keys[key] = false;
      });
    });
    

    window.addEventListener('keydown', e => {
      if (e.key === 'm') {
        bgMusic.muted = !bgMusic.muted;
        showMessage(bgMusic.muted ? 'üîá Music Off' : 'üéµ Music On');
      }
    });





  
    function showMessage(text) {
      currentMessage = text;
      messageAlpha = 1;
      messageTimer = 2; 
    }
    
    function createParticles(x, y, color) {
      for (let i = 0; i < 20; i++) {
        particles.push({
          x, y,
          vx: (Math.random() - 0.5) * 200,
          vy: (Math.random() - 0.5) * 200 - 100,
          life: 1,
          decay: Math.random() * 0.02 + 0.01,
          size: Math.random() * 4 + 2,
          color
        });
      }
    }


 const COW_MIN_SPACING = 140; 
    
function spawnCows() {
  cows = [];
  const numCows = 8 + Math.floor(Math.random() * 5);
  const usedPositions = [];

  for (let i = 0; i < numCows; i++) {
    let x;
    let attempts = 0;

    do {
      x = 100 + Math.random() * (levelWidth - 200);
      attempts++;
    } while (
      usedPositions.some(px => Math.abs(px - x) < COW_MIN_SPACING) &&
      attempts < 50
    );

    usedPositions.push(x);

    const vx = (Math.random() - 0.5) * 50;

    cows.push({
      x,
      y: groundY - COW_HEIGHT / 2,
      vx,
      state: 'idle',
      frame: 0,
      animTime: 0,
      scared: false,
      idleTime: Math.random() * 3,
      facingRight: vx < 0
    });
  }
}



    function drawCow(cow, x, y) {
      const isScared = cow.scared || cow.state === 'abducting';
      
      const frameIndex = cow.state === 'idle' ? 0 : Math.min(cow.frame, 8);
      
      ctx.save();
      
      if (cow.facingRight) {
        ctx.translate(x, y);
      } else {
        ctx.translate(x + COW_WIDTH, y);
        ctx.scale(-1, 1);
      }
      
      if (spritesLoaded && cowFrameWidth > 0) {
        ctx.drawImage(
          cowSpriteSheet,
          frameIndex * cowFrameWidth, 0,
          cowFrameWidth, cowFrameHeight,
          0, 0,
          COW_WIDTH, COW_HEIGHT
        );
      } else {
        ctx.fillStyle = isScared ? '#FF69B4' : '#FFB6C1';
        ctx.fillRect(10, 30, 50, 30);
        ctx.fillRect(45, 15, 20, 20);
        
        const legOffset = Math.sin(cow.animTime * 10) * 3;
        ctx.fillRect(15, 60 + legOffset, 8, 10);
        ctx.fillRect(28, 60 - legOffset, 8, 10);
        ctx.fillRect(38, 60 + legOffset, 8, 10);
        ctx.fillRect(48, 60 - legOffset, 8, 10);
        
        ctx.fillStyle = '#000';
        ctx.fillRect(20, 35, 8, 8);
        ctx.fillRect(35, 42, 10, 10);
        ctx.fillRect(50, 20, 3, 3);
        ctx.fillRect(58, 20, 3, 3);
        
        if (isScared) {
          ctx.fillStyle = '#FF0000';
          ctx.font = '14px Arial';
          ctx.fillText('!', 30, 15);
        }
      }
      
      ctx.restore();
      
      if (cow.scared && cow.state === 'idle') {
        ctx.font = '20px Arial';
        ctx.fillText('üò±', x + 25, y - 5);
      }
    }
    
    function drawUFO() {
      ctx.save();
      ctx.translate(ufo.x, ufo.y);
      ctx.rotate(ufo.angle);
      
      if (ufoSprite.complete && ufoSprite.naturalWidth > 0) {
        ctx.drawImage(ufoSprite, -ufo.w / 2, -ufo.h / 2, ufo.w, ufo.h);
      } else {
        ctx.fillStyle = '#4dd9a8';
        ctx.beginPath();
        ctx.ellipse(0, 5, 70, 30, 0, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#67FEBD';
        ctx.beginPath();
        ctx.ellipse(0, -5, 40, 20, 0, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = '#00ffff';
        ctx.beginPath();
        ctx.ellipse(0, -5, 15, 8, 0, 0, Math.PI * 2);
        ctx.fill();
      }
      
      const time = Date.now() / 200;
      for (let i = 0; i < 5; i++) {
        const angle = (i / 5) * Math.PI * 2 + time;
        const x = Math.cos(angle) * 50;
        const y = Math.sin(angle) * 25 + 5;
        ctx.fillStyle = `hsl(${(time * 50 + i * 72) % 360}, 100%, 70%)`;
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
      }
      
      ctx.restore();
    }
    
    function update(dt) {
      const speed = 400;
      
      ufo.vx = ufo.vy = 0;
      if (keys.a || keys.A || keys.ArrowLeft) ufo.vx = -speed;
      if (keys.d || keys.D || keys.ArrowRight) ufo.vx = speed;
      if (keys.w || keys.W || keys.ArrowUp) ufo.vy = -speed;
      if (keys.s || keys.S || keys.ArrowDown) ufo.vy = speed;
      
      ufo.x += ufo.vx * dt;
      ufo.y += ufo.vy * dt;
      
      ufo.x = Math.max(70, Math.min(levelWidth - 70, ufo.x));
      ufo.y = Math.max(30, Math.min(350, ufo.y));
      
      ufo.angle = ufo.vx * 0.0003;
      
      const targetCameraX = ufo.x - canvas.width / 2;
      camera.x += (targetCameraX - camera.x) * 0.1;
      camera.x = Math.max(0, Math.min(levelWidth - canvas.width, camera.x));
      
      if (spaceJustPressed && keys.space) {
        spaceJustPressed = false;
        
        for (let cow of cows) {
          if (cow.state !== 'idle') continue;
          
          const dx = Math.abs(ufo.x - cow.x);
          const dy = Math.abs(ufo.y - cow.y);
          
         
          const distance = Math.sqrt(dx * dx + dy * dy);
          
          if (distance < 120 && ufo.y < cow.y) { 
            cow.state = 'abducting';
            cow.frame = 1;
            createParticles(cow.x, cow.y, '#67FEBD');
            break;
          }
        }
      }
      
      cows = cows.filter(cow => {
        cow.animTime += dt;
        
        if (cow.state === 'idle') {
          cow.idleTime -= dt;
          if (cow.idleTime <= 0) {
            const oldVx = cow.vx;
            cow.vx = (Math.random() - 0.5) * 50;
            if (cow.vx > 0) cow.facingRight = false;
            else if (cow.vx < 0) cow.facingRight = true;
            cow.idleTime = Math.random() * 3 + 1;
          }
          
          cow.x += cow.vx * dt;
          cow.x = Math.max(50, Math.min(levelWidth - 50, cow.x));
          
          const dist = Math.abs(ufo.x - cow.x);
          cow.scared = dist < 150 && ufo.y < cow.y - 50;
          
        } else if (cow.state === 'abducting') {
          if (cow.animTime >= 0.1) {
            cow.animTime = 0;
            cow.frame++;
            if (cow.frame > 8) cow.frame = 1; 
          }
          
          cow.y -= 200 * dt;
          
          // SPARKLES
          if (Math.random() < 0.3) {
            createParticles(cow.x, cow.y, '#ffffff');
          }
          
          if (cow.y <= ufo.y + 20) {
            score++;
            
            const satisfactionIndex = Math.min(Math.floor(score / 2), satisfactionLevels.length - 1);
            
            const msg = Math.random() < 0.3 
              ? cowFacts[Math.floor(Math.random() * cowFacts.length)]
              : abductionMessages[Math.floor(Math.random() * abductionMessages.length)];
            showMessage(msg);
            
            createParticles(cow.x, cow.y, '#dc4ce8');
            
            setTimeout(() => {
              const spawnX = Math.random() * levelWidth;
              const spawnVx = (Math.random() - 0.5) * 50;
              cows.push({
                x: spawnX,
                y: groundY - COW_HEIGHT / 2,
                vx: spawnVx,
                state: 'idle',
                frame: 0,
                animTime: 0,
                scared: false,
                idleTime: Math.random() * 3,
                facingRight: spawnVx < 0
              });
              totalCows++;
            }, 2000);
            
            return false;
          }
        }
        
        return true;
      });
      
      if (messageTimer > 0) {
        messageTimer -= dt;
        if (messageTimer <= 0) {
          messageAlpha = 0;
        } else if (messageTimer < 0.3) {
          messageAlpha = messageTimer / 0.3; 
        }
      }
      
      particles = particles.filter(p => {
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.vy += 300 * dt;
        p.life -= p.decay;
        return p.life > 0;
      });
    }
    
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      ctx.save();
      ctx.translate(-camera.x, 0);
      
      const gradient = ctx.createLinearGradient(0, groundY, 0, canvas.height);
      gradient.addColorStop(0, '#2d5016');
      gradient.addColorStop(1, '#1a2f0d');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, groundY, levelWidth, groundHeight);
      
      ctx.fillStyle = '#3d6020';
      for (let i = 0; i < 100; i++) {
        const x = (i / 100) * levelWidth;
        ctx.fillRect(x, groundY + 10, 30, 5);
        ctx.fillRect(x + 20, groundY + 30, 40, 3);
      }
      
      particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life;
        ctx.fillRect(p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
      });
      ctx.globalAlpha = 1;
      
      cows.forEach(cow => {
        if (cow.state === 'abducting') {
          const beamTop = ufo.y + 30;
          const beamHeight = cow.y - beamTop;
          const beamWidth = 100;
          
          const glow = ctx.createLinearGradient(cow.x, beamTop, cow.x, cow.y);
          glow.addColorStop(0, 'rgba(103, 254, 189, 0.1)');
          glow.addColorStop(1, 'rgba(103, 254, 189, 0.4)');
          ctx.fillStyle = glow;
          ctx.fillRect(cow.x - beamWidth * 0.6, beamTop, beamWidth * 1.2, beamHeight);
          
          const beam = ctx.createLinearGradient(cow.x, beamTop, cow.x, cow.y);
          beam.addColorStop(0, 'rgba(0, 255, 255, 0.3)');
          beam.addColorStop(1, 'rgba(0, 255, 255, 0.6)');
          ctx.fillStyle = beam;
          ctx.fillRect(cow.x - beamWidth / 2, beamTop, beamWidth, beamHeight);
          
          for (let i = 0; i < 5; i++) {
            const y = beamTop + Math.random() * beamHeight;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.fillRect(cow.x + (Math.random() - 0.5) * beamWidth, y, 3, 3);
          }
        }
        
        drawCow(cow, cow.x - COW_WIDTH / 2, cow.y - COW_HEIGHT / 2);
      });
      
      drawUFO();
      
      ctx.restore();
      
      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
      ctx.fillRect(0, 0, canvas.width, 50);
      
      ctx.font = 'bold 18px Orbitron';
      ctx.fillStyle = '#67FEBD';
      ctx.textAlign = 'left';
      ctx.fillText(`COWS ABDUCTED: `, 20, 30);
      ctx.fillStyle = '#dc4ce8';
      ctx.fillText(score, 220, 30);
      
      ctx.fillStyle = '#67FEBD';
      ctx.fillText(`COWS LEFT: `, 350, 30);
      ctx.fillStyle = '#dc4ce8';
      ctx.fillText(cows.length, 490, 30);
      
      ctx.fillStyle = '#67FEBD';
      ctx.fillText(`SATISFACTION: `, 620, 30);
      const satisfactionIndex = Math.min(Math.floor(score / 2), satisfactionLevels.length - 1);
      ctx.font = '24px Arial';
      ctx.fillText(satisfactionLevels[satisfactionIndex], 810, 32);
      
      if (messageAlpha > 0 && currentMessage) {
        ctx.globalAlpha = messageAlpha;
        
        ctx.font = 'bold 18px Orbitron';
        ctx.textAlign = 'center';
        
        const textMetrics = ctx.measureText(currentMessage);
        const textWidth = textMetrics.width;
        const textHeight = 20;
        const padding = 10;
        
        const msgX = canvas.width / 2;
        const msgY = canvas.height - 25; 
        
        ctx.fillStyle = 'rgba(220, 76, 232, 0.9)';
        ctx.fillRect(
          msgX - textWidth / 2 - padding,
          msgY - textHeight / 2 - padding / 2,
          textWidth + padding * 2,
          textHeight + padding
        );
        
        ctx.strokeStyle = '#dc4ce8';
        ctx.lineWidth = 2;
        ctx.strokeRect(
          msgX - textWidth / 2 - padding,
          msgY - textHeight / 2 - padding / 2,
          textWidth + padding * 2,
          textHeight + padding
        );
        
        ctx.fillStyle = '#fff';
        ctx.fillText(currentMessage, msgX, msgY + 5);
        
        ctx.globalAlpha = 1;
        ctx.textAlign = 'left';
      }


      const muteButton = {
        x: 920,
        y: 10,
        w: 40,
        h: 40
      };


      ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
      ctx.fillRect(muteButton.x, muteButton.y, muteButton.w, muteButton.h);

      ctx.strokeStyle = '#67FEBD';
      ctx.lineWidth = 2;
      ctx.strokeRect(muteButton.x, muteButton.y, muteButton.w, muteButton.h);

      ctx.font = '22px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#67FEBD';
      ctx.fillText(
        bgMusic.muted ? 'üîá' : 'üîä',
        muteButton.x + muteButton.w / 2,
        muteButton.y + muteButton.h / 2
      );

      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';


    }
    


    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;

      const mouseX = (e.clientX - rect.left) * scaleX;
      const mouseY = (e.clientY - rect.top) * scaleY;

      if (
        mouseX >= muteButton.x &&
        mouseX <= muteButton.x + muteButton.w &&
        mouseY >= muteButton.y &&
        mouseY <= muteButton.y + muteButton.h
      ) {
        bgMusic.muted = !bgMusic.muted;
        showMessage(bgMusic.muted ? 'üîá Music muted' : 'üéµ Music on');
      }
    });


    let lastTime = Date.now();
    function loop() {
      const now = Date.now();
      const dt = Math.min((now - lastTime) / 1000, 0.1);
      lastTime = now;
      
      update(dt);
      draw();
      requestAnimationFrame(loop);
    }
    
    spawnCows();
    showMessage("Welcome to the pasture! üêÑ‚ú®");
    loop();
  </script>
</body>
</html>